{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "offer-modal-04",
  "type": "registry:block",
  "description": "Interactive fortune wheel modal with email-to-spin mechanic, animated wheel with color segments, percentage discount results, and alert notification for prizes",
  "registryDependencies": [
    "button",
    "dialog",
    "input",
    "alert",
    "utils"
  ],
  "files": [
    {
      "path": "src/registry/new-york/blocks/ecommerce/offer-modal/offer-modal-04/page.tsx",
      "content": "import OfferModal from '@/components/shadcn-studio/blocks/offer-modal-04/offer-modal-04'\nimport { Button } from '@/components/ui/button'\n\nconst OfferModalPage = () => {\n  return (\n    <div className='flex h-dvh items-start justify-center p-8'>\n      <OfferModal defaultOpen trigger={<Button variant='outline'>Offer Modal</Button>} />\n    </div>\n  )\n}\n\nexport default OfferModalPage\n",
      "type": "registry:page",
      "target": "app/offer-modal-04/page.tsx"
    },
    {
      "path": "src/registry/new-york/components/blocks/offer-modal-04/offer-modal-04.tsx",
      "content": "'use client'\n\nimport { useState, useRef, type ReactNode } from 'react'\n\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger\n} from '@/components/ui/dialog'\nimport { Input } from '@/components/ui/input'\nimport { Button } from '@/components/ui/button'\nimport { Alert, AlertTitle } from '@/components/ui/alert'\nimport { cn } from '@/lib/utils'\n\ntype OfferModalProps = {\n  trigger?: ReactNode\n  defaultOpen?: boolean\n}\n\nconst OfferModal04 = ({ trigger, defaultOpen }: OfferModalProps) => {\n  const [isOpen, setIsOpen] = useState(defaultOpen || false)\n  const [isSpinning, setIsSpinning] = useState(false)\n  const [result, setResult] = useState<string | null>(null)\n  const wheelRef = useRef<HTMLUListElement>(null)\n  const formRef = useRef<HTMLFormElement>(null)\n  const animationRef = useRef<Animation | null>(null)\n  const previousEndDegreeRef = useRef(0)\n\n  const wheelSegments = [\n    { text: 'Next time', bgColor: 'var(--color-fuchsia-300)' },\n    { text: '10% off', bgColor: 'var(--color-lime-300)' },\n    { text: '5% off', bgColor: 'var(--color-cyan-400)' },\n    { text: 'Next time', bgColor: 'var(--color-fuchsia-300)' },\n    { text: '15% off', bgColor: 'var(--color-lime-300)' },\n    { text: '10% off', bgColor: 'var(--color-fuchsia-300)' },\n    { text: '5% off', bgColor: 'var(--color-cyan-400)' }\n  ]\n\n  const getResultAtTop = () => {\n    if (!wheelRef.current) return null\n\n    // Calculate which segment is at the top based on rotation\n    const totalSegments = wheelSegments.length\n    const segmentAngle = 360 / totalSegments\n\n    // Normalize the rotation to be between 0 and 360\n    const normalizedRotation = ((previousEndDegreeRef.current % 360) + 270) % 360\n\n    // Calculate which segment is at the top (pointing upward)\n    // We need to account for the wheel starting position and direction of rotation\n    const adjustedRotation = (360 - normalizedRotation + segmentAngle / 2) % 360\n    const segmentIndex = Math.floor(adjustedRotation / segmentAngle) % totalSegments\n\n    return wheelSegments[segmentIndex]?.text || null\n  }\n\n  const spinWheel = () => {\n    if (!wheelRef.current || isSpinning) return\n\n    setIsSpinning(true)\n    setResult(null)\n\n    if (animationRef.current) {\n      animationRef.current.cancel()\n    }\n\n    const randomAdditionalDegrees = Math.random() * 360 + 1800\n    const newEndDegree = previousEndDegreeRef.current + randomAdditionalDegrees\n\n    animationRef.current = wheelRef.current.animate(\n      [{ transform: `rotate(${previousEndDegreeRef.current}deg)` }, { transform: `rotate(${newEndDegree}deg)` }],\n      {\n        duration: 4000,\n        direction: 'normal',\n        easing: 'cubic-bezier(0.440, -0.205, 0.000, 1.130)',\n        fill: 'forwards',\n        iterations: 1\n      }\n    )\n\n    animationRef.current.onfinish = () => {\n      setIsSpinning(false)\n      const currentValue = getResultAtTop()\n\n      setResult(currentValue)\n\n      // Reset the form/input field after spin completes\n      if (formRef.current) {\n        formRef.current.reset()\n      }\n    }\n\n    previousEndDegreeRef.current = newEndDegree\n  }\n\n  const handleFormSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    spinWheel()\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild onClick={() => setIsOpen(true)}>\n        {trigger}\n      </DialogTrigger>\n      <DialogContent className='[&_[data-slot=\"dialog-close\"]]:bg-primary/10 flex w-full flex-col items-center justify-center gap-6 text-center lg:max-w-md [&_[data-slot=\"dialog-close\"]]:flex [&_[data-slot=\"dialog-close\"]]:size-7 [&_[data-slot=\"dialog-close\"]]:items-center [&_[data-slot=\"dialog-close\"]]:justify-center [&_[data-slot=\"dialog-close\"]]:rounded-full'>\n        <DialogHeader>\n          <DialogTitle className='text-3xl font-semibold'>It&apos;s your lucky day!</DialogTitle>\n          <DialogDescription className='text-center text-lg'>\n            Enter your email to <br /> spin the wheel\n          </DialogDescription>\n        </DialogHeader>\n\n        {/* Fortune Wheel */}\n        <div className='relative rounded-full border-12 border-white shadow-[0px_0px_27.1px_4px_rgba(0,_0,_0,_0.15)]'>\n          <fieldset className='wheel-of-fortune [container-type:inline-size] relative grid size-63 [--_items:7] *:absolute after:absolute after:-top-4 after:z-10 after:aspect-[1/cos(30deg)] after:h-[7cqi] after:scale-[2] after:[place-self:start_center] after:bg-black after:[clip-path:polygon(50%_100%,_100%_0,_0_0)] sm:size-76'>\n            <ul\n              ref={wheelRef}\n              data-item-count='7'\n              className='wheel-segments inset-0 m-0 grid list-none [place-content:center_start] p-0 [clip-path:inset(0_0_0_0_round_50%)]'\n            >\n              {wheelSegments.map((segment, index) => (\n                <li\n                  key={index}\n                  className='wheel-segment grid aspect-[1/calc(2*tan(180deg/var(--_items)))] w-[50cqi] origin-[center_right] content-center pr-8 text-end text-xl font-semibold text-black select-none [clip-path:_polygon(0%_0%,_100%_50%,_0%_100%)] [grid-area:1/-1] max-sm:text-sm'\n                  style={{ backgroundColor: segment.bgColor, rotate: `calc(360deg / var(--_items) * ${index})` }}\n                >\n                  {segment.text}\n                </li>\n              ))}\n            </ul>\n            <div className='absolute top-1/2 left-1/2 flex size-13.5 -translate-x-1/2 -translate-y-1/2 items-center justify-center rounded-full border-2 border-white bg-white'>\n              <img\n                src='https://cdn.shadcnstudio.com/ss-assets/logo/logo.png'\n                className='size-9.5 rounded-full'\n                alt='brand-logo'\n              />\n            </div>\n          </fieldset>\n        </div>\n\n        {result && (\n          <Alert\n            className={cn('border-none bg-green-600/10 text-green-600 dark:bg-green-400/10 dark:text-green-400', {\n              'bg-amber-600/10 text-amber-600 dark:bg-amber-400/10 dark:text-amber-400': result == 'Next time'\n            })}\n          >\n            <AlertTitle>{result === 'Next time' ? 'Better luck next time!' : `You won ${result}!`}</AlertTitle>\n          </Alert>\n        )}\n\n        <form ref={formRef} onSubmit={handleFormSubmit} className='flex w-full flex-col justify-center gap-4'>\n          <Input type='email' placeholder='Email' className='h-10 w-full' required />\n\n          <Button type='submit' size='lg' disabled={isSpinning}>\n            {isSpinning ? 'Spinning...' : 'Spin the wheel'}\n          </Button>\n        </form>\n\n        <a href='#' className='text-muted-foreground hover:text-primary underline'>\n          Remind me later!\n        </a>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default OfferModal04\n",
      "type": "registry:component",
      "target": "components/shadcn-studio/blocks/offer-modal-04/offer-modal-04.tsx"
    }
  ]
}